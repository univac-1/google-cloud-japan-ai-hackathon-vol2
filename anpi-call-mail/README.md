# ğŸš¨ å®‰å¦ç¢ºèªã‚·ã‚¹ãƒ†ãƒ  - è‡ªæ²»ä½“é€šå ±æ©Ÿèƒ½

å®‰å¦ç¢ºèªé›»è©±ã®çµæœã€ç›´æ¥è¨ªå•ãŒå¿…è¦ã¨åˆ¤æ–­ã•ã‚ŒãŸå ´åˆã«è‡ªæ²»ä½“ã¸ç·Šæ€¥é€šå ±ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã™ã‚‹GCP Cloud Functionsã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

**Gmail APIã‚’ä½¿ç”¨**ã—ã¦ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’è¡Œã„ã¾ã™ã€‚

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. Gmail APIè¨­å®š
1. Google Cloud Consoleã§Gmail APIã‚’æœ‰åŠ¹åŒ–
2. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—JSONã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
3. è©³ç´°ã¯ `gmail_setup_guide.md` ã‚’å‚ç…§

### 2. ç’°å¢ƒå¤‰æ•°è¨­å®š
```bash
./setup_env.sh
```

### 3. ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
```bash
./setup_and_deploy.sh
```

### 4. å®‰å¦ç¢ºèªé€šå ±ãƒ†ã‚¹ãƒˆ
```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ãƒ†ã‚¹ãƒˆ
./test.sh

# ã‚«ã‚¹ã‚¿ãƒ å€¤ã§ãƒ†ã‚¹ãƒˆ
./test.sh safety@city.tokyo.jp ç”°ä¸­ å¤ªéƒ 090-1234-5678
```

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
â”œâ”€â”€ main.py                    # Cloud Function ãƒ¡ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆGmail APIä½¿ç”¨ï¼‰
â”œâ”€â”€ requirements.txt           # Pythonä¾å­˜é–¢ä¿‚
â”œâ”€â”€ setup_env.sh              # ç’°å¢ƒå¤‰æ•°è¨­å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ setup_and_deploy.sh       # è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ setup_secret_manager.sh   # Secret Managerè¨­å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ test.sh                   # ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ gmail_setup_guide.md      # Gmail APIè¨­å®šã‚¬ã‚¤ãƒ‰
â””â”€â”€ README.md                 # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ğŸ“§ APIä»•æ§˜

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
```
POST https://asia-northeast1-univac-aiagent.cloudfunctions.net/send-mail
```

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
```json
{
    "to": "safety@city.tokyo.jp",
    "last_name": "ç”°ä¸­",
    "first_name": "å¤ªéƒ", 
    "phone_number": "090-1234-5678",
    "timestamp": "2025-06-14 13:45:30"
}
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹
**æˆåŠŸæ™‚ï¼ˆ200ï¼‰:**
```json
{
    "status": "success",
    "message": "Safety check notification sent to local government",
    "target_person": "ç”°ä¸­ å¤ªéƒ",
    "phone_number": "090-1234-5678",
    "sent_to": "safety@city.tokyo.jp",
    "gmail_message_id": "187abc123..."
}
```

## ğŸ”§ ä½¿ç”¨ä¾‹

### å®‰å¦ç¢ºèªã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ã®è‡ªå‹•é€šå ±
```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -d '{
    "to": "safety@city.tokyo.jp",
    "last_name": "ç”°ä¸­",
    "first_name": "å¤ªéƒ",
    "phone_number": "090-1234-5678",
    "timestamp": "2025-06-14 13:45:30"
  }' \
  $(cat function_url.txt)
```

### ãƒ¡ãƒ¼ãƒ«å†…å®¹ã®ç‰¹å¾´
- ğŸ“§ ç·Šæ€¥æ€§ã‚’ä¼ãˆã‚‹ä»¶åã¨æœ¬æ–‡
- ğŸ‘¤ å¯¾è±¡è€…ã®åŸºæœ¬æƒ…å ±ï¼ˆæ°åãƒ»é›»è©±ç•ªå·ï¼‰
- â° é€šå ±æ™‚åˆ»ã®è¨˜éŒ²
- ğŸ“‹ è‡ªæ²»ä½“å‘ã‘ã®å¯¾å¿œæ‰‹é †
- ğŸš¨ HTMLãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ã‚ˆã‚‹è¦–èªæ€§å‘ä¸Š

## âš ï¸ æ³¨æ„äº‹é …

1. **Gmail APIèªè¨¼**: Google Cloud Consoleã§Gmail APIã®æœ‰åŠ¹åŒ–ã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è¨­å®šãŒå¿…è¦ã§ã™
2. **é€ä¿¡åˆ¶é™**: Gmail APIã«ã¯1æ—¥ã‚ãŸã‚Šã®é€ä¿¡æ•°åˆ¶é™ãŒã‚ã‚Šã¾ã™ï¼ˆå€‹äººGmail: 500é€š/æ—¥ã€Google Workspace: 10,000é€š/æ—¥ï¼‰
3. **ç·Šæ€¥æ€§**: ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ç·Šæ€¥æ™‚ã®è‡ªæ²»ä½“é€šå ±ç”¨ã§ã™ã€‚ãƒ†ã‚¹ãƒˆæ™‚ã¯å®Ÿéš›ã®è‡ªæ²»ä½“ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„
4. **å€‹äººæƒ…å ±**: å®‰å¦ç¢ºèªå¯¾è±¡è€…ã®å€‹äººæƒ…å ±ã‚’é©åˆ‡ã«ç®¡ç†ã—ã¦ãã ã•ã„
5. **ãƒ‰ãƒ¡ã‚¤ãƒ³å…¨ä½“ã®å§”ä»»**: Google Workspaceã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰é€ä¿¡ã™ã‚‹å ´åˆã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å…¨ä½“ã®å§”ä»»è¨­å®šãŒå¿…è¦ã§ã™

## ğŸ“š è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Gmail APIè¨­å®šã‚¬ã‚¤ãƒ‰](gmail_setup_guide.md) - Gmail APIã®è©³ç´°è¨­å®šæ–¹æ³•
